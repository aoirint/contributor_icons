<!DOCTYPE html>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
    html { background-color: #FFFFFF; }
</style>

<textarea id="text" cols="80" rows="10">
Hiroshiba/voicevox
Hiroshiba/voicevox_engine
Hiroshiba/voicevox_core
</textarea>

<hr>

<button id="button" type="button">Fetch</button>

<hr>

<div id="contributors" style="display: flex; flex-wrap: wrap; margin: 70px 50px">
</div>

<script>
    const size = 64
    const margin = '4px'

    const contributors = document.querySelector('#contributors')

    button.addEventListener('click', (event) => {
        while (contributors.firstChild) contributors.removeChild(contributors.firstChild)

        Promise.all(
            text.value.split('\n')
                .filter((value) => value !== '')
                .map((value) => `https://api.github.com/repos/${value}/contributors`)
                .map((url) => fetch(url))
        )
            .then((responses) => 
                Promise.all(
                    responses.map((response) => response.json())
                )
                .then((responses) => {
                    const contributorList = responses
                        .flatMap((response) => response)

                    const loginList = contributorList.map(({ login }) => login)

                    contributorList
                        .filter(({ login }, index) => loginList.indexOf(login) === index)
                        .sort(({ contributions: a }, { contributions: b }) => b - a)
                        .map(({
                            login,
                            avatar_url,
                            html_url
                        }) => {
                            const user = document.createElement('div')
                            user.style.margin = margin

                            const img = document.createElement('img')
                            img.src = avatar_url
                            img.title = login
                            img.width = size
                            img.height = size
                            img.style.borderRadius = '50%'

                            const anchor = document.createElement('a')
                            anchor.href = html_url
                            anchor.append(img)

                            user.append(anchor)

                            return user
                        }).forEach((element) => {
                            contributors.append(element)
                        })
                })
            )
    })
</script>
