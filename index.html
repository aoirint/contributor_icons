<!DOCTYPE html>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
    html { background-color: #FFFFFF; }
    .user {
    }
    .anchor {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #333333;
        text-decoration: none;
        width: 100px;
        height: 100px;
    }
    .icon {
        display: block;
        border-radius: 50%;
    }
    .name {
        font-size: 10pt;
    }
</style>

<textarea id="text" cols="80" rows="10">
Hiroshiba/voicevox
Hiroshiba/voicevox_engine
Hiroshiba/voicevox_core
</textarea>

<hr>

<div class="template user">
    <a
        class="anchor"
        href="https://github.com/aoirint"
    >
        <img
            class="icon"
            src="https://avatars.githubusercontent.com/u/27213639?v=4"
            title="aoirint"
            width="64"
            height="64"
        >
        <div class="name">
            aoirint
        </div>
    </a>

</div>

<button id="button" type="button">Fetch</button>

<hr>

<div id="contributors" style="display: flex; flex-wrap: wrap; margin: 70px 50px">
</div>

<script>
    const contributors = document.querySelector('#contributors')
    const template = document.querySelector('.template')

    button.addEventListener('click', (event) => {
        while (contributors.firstChild) contributors.removeChild(contributors.firstChild)

        Promise.all(
            text.value.split('\n')
                .filter((value) => value !== '')
                .map((value) => `https://api.github.com/repos/${value}/contributors`)
                .map((url) => fetch(url))
        )
            .then((responses) => 
                Promise.all(
                    responses.map((response) => response.json())
                )
                .then((responses) => {
                    const contributorList = responses
                        .flatMap((response) => response)

                    const loginList = contributorList.map(({ login }) => login)

                    contributorList
                        .filter(({ login }, index) => loginList.indexOf(login) === index)
                        .sort(({ contributions: a }, { contributions: b }) => b - a)
                        .map(({
                            login,
                            avatar_url,
                            html_url
                        }) => {
                            const user = template.cloneNode(true)

                            const img = user.querySelector('.icon')
                            img.src = avatar_url
                            img.title = login

                            const anchor = user.querySelector('.anchor')
                            anchor.href = html_url

                            const name = user.querySelector('.name')
                            name.innerText = login

                            return user
                        }).forEach((element) => {
                            contributors.append(element)
                        })
                })
            )
    })
</script>
